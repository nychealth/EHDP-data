#!/bin/bash

###########################################################################################-
###########################################################################################-
##
## Running all data export scripts
##
###########################################################################################-
###########################################################################################-

#-----------------------------------------------------------------------------------------#
# setup
#-----------------------------------------------------------------------------------------#

# - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - #
# get parent dir for absolute path
# - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - #

base_dir=$(pwd)
export base_dir=$base_dir

# - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - #
# source script to set environment params
# - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - #

source "$base_dir/export-scripts/set_environment.bash"

# - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - #
# choose to export spark bars
# - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - #

echo "-------------------------------------------------------------"
read -p "Run 'NR_sparkbars.py'? Yes [y] / No [*n] -- " -n 1 sparkbar
printf "\n"
echo "-------------------------------------------------------------"

#=========================================================================================#
# R
#=========================================================================================#

#-----------------------------------------------------------------------------------------#
# EXP data
#-----------------------------------------------------------------------------------------#

echo ">>> EXP_data_json"
Rscript "$base_dir/export-scripts/EXP_data_json.R"

#-----------------------------------------------------------------------------------------#
# EXP metadata
#-----------------------------------------------------------------------------------------#

echo ">>> EXP_metadata_json"
Rscript "$base_dir/export-scripts/EXP_metadata_json.R"

#-----------------------------------------------------------------------------------------#
# EXP comparisons
#-----------------------------------------------------------------------------------------#

echo ">>> EXP_comparisons_json"
Rscript "$base_dir/export-scripts/EXP_comparisons_json.R"

#-----------------------------------------------------------------------------------------#
# EXP TimePeriods
#-----------------------------------------------------------------------------------------#

echo ">>> EXP_TimePeriods_json"
Rscript "$base_dir/export-scripts/EXP_TimePeriods_json.R"

#-----------------------------------------------------------------------------------------#
# EXP GeoLookup
#-----------------------------------------------------------------------------------------#

echo ">>> EXP_GeoLookup_json"
Rscript "$base_dir/export-scripts/EXP_GeoLookup_json.R"

#-----------------------------------------------------------------------------------------#
# NR data (for hugo & VegaLite)
#-----------------------------------------------------------------------------------------#

echo ">>> NR_data_json"
Rscript "$base_dir/export-scripts/NR_data_json.R"


#=========================================================================================#
# Python
#=========================================================================================#

if [[ "$sparkbar" == "y" ]]; then

  # - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - #
  # Tell conda which environment to load
  # - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - #

  eval "$(conda shell.bash hook)"
  conda activate EHDP-data

  #-----------------------------------------------------------------------------------------#
  # NR spark bars
  #-----------------------------------------------------------------------------------------#

  echo "-------------------------------------------------------------"
  echo ">>> NR_sparkbars"
  python "$base_dir/export-scripts/NR_sparkbars.py"

fi

# # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # #
# # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # #
# #
# #                             ---- THIS IS THE END! ----
# #
# # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # #
# # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # #
