#!/bin/bash

###########################################################################################-
###########################################################################################-
##
## Update views and stored procedures in database
##
###########################################################################################-
###########################################################################################-

#-----------------------------------------------------------------------------------------#
# setup
#-----------------------------------------------------------------------------------------#

# - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - #
# get parent dir for absolute path
# - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - #

base_dir=$(pwd)
export base_dir=$base_dir

# - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - #
# source script to set environment params
# - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - #

source "$base_dir/export-scripts/set_environment.bash"

# - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - #
# set database name
# - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - #

if [[ "$data_env" == "s" ]]; then

    db_name="BESP_IndicatorAnalysis"

elif [[ "$data_env" == "p" ]]; then

    db_name="BESP_Indicator"

fi


#=========================================================================================#
# run updates
#=========================================================================================#

#-----------------------------------------------------------------------------------------#
# get file names
#-----------------------------------------------------------------------------------------#

views=$(ls "$base_dir/export-scripts/SQL-Server-DB-views")

#-----------------------------------------------------------------------------------------#
# update database using `sqlcmd`
#-----------------------------------------------------------------------------------------#

for v in $views; do

    echo "-------------------------------------------------------------"
    echo "$v"
    echo "- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -"

    sqlcmd -i "$base_dir/export-scripts/SQL-Server-DB-views/$v" -S $server -d $db_name -E -C

done


# # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # #
# # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # #
# #
# #                             ---- THIS IS THE END! ----
# #
# # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # #
# # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # #
