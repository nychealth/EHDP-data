{
    "$schema": "https://vega.github.io/schema/vega/v5.json",
    "autosize": {"type": "fit", "contains": "padding"},
    "background": "#f8f9fa",
    "padding": 5,
    "style": "cell",
    "data": [
      {"name": "highlight_store"},
      {"name": "hviData"},
      {
        "name": "data_1",
        "source": "hviData"
      },
      {
        "name": "source_0",
        "url": "topo",
        "format": {"type": "topojson", "feature": "collection"},
        "transform": [{"type": "identifier", "as": "_vgsid_"}]
      },
      {
        "name": "data_0",
        "source": "source_0",
        "transform": [
          {
            "type": "lookup",
            "from": "data_1",
            "key": "NTACode",
            "fields": ["properties.NTACode"],
            "values": ["NTACode", "NTAName", "HVI_RANK"],
            "default": "Parks/Cemeteries/Airports(unpopulated)"
          }
        ]
      },
      {
      "name": "NTAexclude","values": [{"excludeList":"MN99"},{"excludeList":"QN98"},{"excludeList":"BK99"},{"excludeList":"QN99"},{"excludeList":"BX99"},{"excludeList":"SI99"}]
      }
    ],
    "projections": [
      {
        "name": "projection",
        "size": {"signal": "[width, height]"},
        "fit": {"signal": "[data('source_0'), data('data_0')]"}
      }
    ],
    "signals": [
      {
        "name": "width",
        "init": "isFinite(containerSize()[0]) ? containerSize()[0] : 200",
        "on": [
          {
            "update": "isFinite(containerSize()[0]) ? containerSize()[0] : 200",
            "events": "window:resize"
          }
        ]
      },
      {
        "name": "height",
        "init": "isFinite(containerSize()[1]) ? containerSize()[1] : 200",
        "on": [
          {
            "update": "isFinite(containerSize()[1]) ? containerSize()[1] : 200",
            "events": "window:resize"
          }
        ]
      },
      {
        "name": "unit",
        "value": {},
        "on": [
          {"events": "mousemove", "update": "isTuple(group()) ? group() : unit"}
        ]
      },
      {
        "name": "highlight",
        "update": "vlSelectionResolve(\"highlight_store\", \"union\")"
      },
      {
        "name": "highlight_tuple",
        "on": [
          {
            "events": [{"source": "scope", "type": "mouseover"}],
            "update": "datum && item().mark.marktype !== 'group' ? {unit: \"layer_1\", fields: highlight_tuple_fields, values: [(item().isVoronoi ? datum.datum : datum)[\"_vgsid_\"]]} : null",
            "force": true
          },
          {"events": [{"source": "scope", "type": "dblclick"}], "update": "null"}
        ]
      },
      {
        "name": "highlight_tuple_fields",
        "value": [{"type": "E", "field": "_vgsid_"}]
      },
      {
        "name": "highlight_modify",
        "on": [
          {
            "events": {"signal": "highlight_tuple"},
            "update": "modify(\"highlight_store\", highlight_tuple, true)"
          }
        ]
      },
      {
        "name": "selectNTA",
        "value": ""
      }
    ],
    "marks": [
      {
        "name": "layer_0_marks",
        "type": "shape",
        "style": ["geoshape"],
        "interactive": false,
        "from": {"data": "source_0"},
        "encode": {
          "update": {
            "fill": {"value": "lightgray"},
            "stroke": {"value": "#ffffff"},
            "ariaRoleDescription": {"value": "geoshape"}
          }
        },
        "transform": [{"type": "geoshape", "projection": "projection"}]
      },
      {
        "name": "layer_1_marks",
        "type": "shape",
        "style": ["geoshape"],
        "interactive": true,
        "from": {"data": "data_0"},
        "encode": {
          "update": {
            "stroke": [
                {
                  "test": "datum.properties.NTACode==selectNTA",
                  "value": "#007bff"
                },
                {"value": "white"}
              ],
            "fill": [{
              "test":"indata('NTAexclude','excludeList',datum.properties.NTACode)",
              "value":"lightgray"
            },
            {"scale": "color", "field": "HVI_RANK"}],
            "strokeWidth": [
              {
                "test": "(vlSelectionTest(\"highlight_store\", datum))",
                "value": 3
              },{
                "test": "datum.properties.NTACode==selectNTA",
                "value": 5
              },
              {"value": 0.5}
            ],
            "tooltip": {
              "signal": "{\"Neighborhood\": isValid(datum[\"NTAName\"]) ? datum[\"NTAName\"] : \"\"+datum[\"NTAName\"], \"HVI score\": format(datum[\"HVI_RANK\"], \"\")}"
            },
            "ariaRoleDescription": {"value": "geoshape"},
            "description": {
              "signal": "\"HVI_RANK\" + \": \" + (isValid(datum[\"HVI_RANK\"]) ? datum[\"HVI_RANK\"] : \"\"+datum[\"HVI_RANK\"]) + \"; \" + \"Neighborhood\" + \": \" + (isValid(datum[\"NTAName\"]) ? datum[\"NTAName\"] : \"\"+datum[\"NTAName\"]) + \"; \" + \"HVI score:\" + \": \" + (format(datum[\"HVI_RANK\"], \"\"))"
            }
          }
        },
        "transform": [{"type": "geoshape", "projection": "projection"}]
      }
    ],
    "scales": [
      {
        "name": "color",
        "type": "ordinal",
        "domain": {"data": "data_0", "field": "HVI_RANK", "sort": true},
        "range": {"scheme": "browns", "extent": [0, 2.5]},
        "interpolate": "hcl"
      }
    ]
  }